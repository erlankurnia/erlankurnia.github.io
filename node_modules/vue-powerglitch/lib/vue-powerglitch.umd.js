(function(o,c){typeof exports=="object"&&typeof module!="undefined"?c(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],c):(o=typeof globalThis!="undefined"?globalThis:o||self,c(o.PowerGlitch={},o.Vue))})(this,function(o,c){"use strict";var R=Object.defineProperty,x=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var M=(o,c,h)=>c in o?R(o,c,{enumerable:!0,configurable:!0,writable:!0,value:h}):o[c]=h,k=(o,c)=>{for(var h in c||(c={}))V.call(c,h)&&M(o,h,c[h]);if(C)for(var h of C(c))B.call(c,h)&&M(o,h,c[h]);return o},A=(o,c)=>x(o,S(c));var h={};Object.defineProperty(h,"__esModule",{value:!0});var g=h.PowerGlitch=void 0;const p=(t="always")=>({playMode:t,createContainers:!0,hideOverflow:!1,timing:t==="always"?{duration:2*1e3,iterations:1/0}:{duration:250,iterations:1},glitchTimeSpan:t==="always"?{start:.5,end:.7}:{start:0,end:1},shake:{velocity:15,amplitudeX:.2,amplitudeY:.2},slice:t==="click"?{count:15,velocity:20,minHeight:.02,maxHeight:.15,hueRotate:!0}:{count:6,velocity:15,minHeight:.02,maxHeight:.15,hueRotate:!0}}),v=(t,a)=>{if(!t.glitchTimeSpan)return 1;const e=t.glitchTimeSpan.start,n=t.glitchTimeSpan.end;if(a<e||a>n)return 0;const i=e+(n-e)/2;return a<i?(a-e)/(i-e):(n-a)/(n-i)},m=(t,a)=>(Math.random()-.5)*2*v(t,a),P=({minHeight:t,maxHeight:a,minWidth:e,maxWidth:n})=>{const i=Math.floor(Math.random()*((a-t)*100+1))+t*100,l=Math.floor(Math.random()*((n-e)*100+1))+e*100,r=Math.floor(Math.random()*(100-i)),s=Math.floor(Math.random()*(100-l)),f=`${s+l}% ${r}%`,d=`${s+l}% ${r+i}%`,u=`${s}% ${r+i}%`,y=`${s}% ${r}%`;return`polygon(${f},${d},${u},${y})`},_=t=>{const a=Math.floor(t.slice.velocity*t.timing.duration/1e3)+1,e=[];for(let n=0;n<a;++n){if(v(t,n/a)===0){e.push({opacity:"0",transform:"",clipPath:"unset"});continue}const i=m(t,n/a)*30,l={opacity:"1",transform:`translate3d(${i}%,0,0)`,clipPath:P({minHeight:t.slice.minHeight,maxHeight:t.slice.maxHeight,minWidth:1,maxWidth:1})};t.slice.hueRotate&&(l.filter=`hue-rotate(${Math.floor(m(t,n/a)*360)}deg)`),e.push(l)}return{steps:e,timing:Object.assign({easing:`steps(${a},jump-start)`},t.timing)}},j=t=>{if(!t.shake)return{steps:[],timing:{}};const a=Math.floor(t.shake.velocity*t.timing.duration/1e3)+1,e=[];for(let n=0;n<a;++n){const i=m(t,n/a)*t.shake.amplitudeX*100,l=m(t,n/a)*t.shake.amplitudeY*100;e.push({transform:`translate3d(${i}%,${l}%,0)`})}return{steps:e,timing:Object.assign({easing:`steps(${a},jump-start)`},t.timing)}},E=t=>[j(t),...Array.from({length:t.slice.count}).map(()=>_(t))],G=(...t)=>{const a=e=>e&&typeof e=="object";return t.reduce((e,n)=>(Object.keys(n).forEach(i=>{const l=e[i],r=n[i];if(Array.isArray(l)&&Array.isArray(r)){e[i]=l.concat(...r);return}if(a(l)&&a(r)){e[i]=G(l,r);return}r!==void 0&&(e[i]=r)}),e),{})},H=(t,a)=>{var e,n;if(!a.createContainers)return{container:t,layersContainer:t,glitched:t.firstElementChild};if(!t.dataset.glitched){const r=document.createElement("div"),s=document.createElement("div");return getComputedStyle(t).getPropertyValue("display").match(/^inline/)&&(s.style.display="inline-block"),s.appendChild(r),(e=t.parentElement)===null||e===void 0||e.insertBefore(s,t),r.prepend(t),{container:s,layersContainer:r,glitched:t}}const i=t.parentElement,l=(n=t.parentElement)===null||n===void 0?void 0:n.parentElement;for(;i.children.length>1;)i.removeChild(i.children[1]);return i.firstElementChild.getAnimations().forEach(r=>r.cancel()),{container:l,layersContainer:i,glitched:t}},L=(t,a,e)=>{const{glitched:n,container:i,layersContainer:l}=H(t,e);l.style.display="grid",e.hideOverflow&&(i.style.overflow="hidden"),e.html&&(n.innerHTML=e.html),n.style.gridArea="1/1/-1/-1";const r=n.cloneNode(!0);r.style.gridArea="1/1/-1/-1",r.style.userSelect="none",r.style.pointerEvents="none",r.style.opacity="0";for(let d=0;d<a.length-1;++d){const u=r.cloneNode(!0);l.appendChild(u)}const s=()=>{a.forEach((d,u)=>{l.children[u].animate(d.steps,d.timing)})},f=()=>{a.forEach((d,u)=>{l.children[u].getAnimations().forEach(y=>{y.cancel()})})};switch(i.onmouseenter=null,i.onmouseleave=null,i.onclick=null,e.playMode){case"always":s();break;case"hover":i.onmouseenter=s,i.onmouseleave=f;break;case"click":i.onclick=()=>{f(),s()};break}return t.dataset.glitched="1",{container:i,startGlitch:s,stopGlitch:f}},T=(t=".powerglitch",a={})=>{const e=G(p(a.playMode),a);let n=[];typeof t=="string"?n=Array.from(document.querySelectorAll(t)):t instanceof NodeList?n=Array.from(t):Array.isArray(t)?n=t:t instanceof HTMLElement&&(n=[t]);const i=E(e),l=n.map(r=>L(r,i,e));return{containers:l.map(r=>r.container),startGlitch:()=>l.forEach(r=>r.startGlitch()),stopGlitch:()=>l.forEach(r=>r.stopGlitch())}};g=h.PowerGlitch={glitch:T,generateLayers:E,getDefaultOptions:p};const $=c.defineComponent({__name:"GlitchedElement",props:{options:{type:Object,required:!1,default:()=>({})},inline:{type:Boolean,required:!1,default:!1}},setup(t,{expose:a}){const e=t;let n=()=>{},i=()=>{};const l=c.ref(null);return c.onMounted(()=>{({startGlitch:n,stopGlitch:i}=g.glitch(l.value,A(k({},e.options),{createContainers:!1})))}),a({startGlitch:()=>n(),stopGlitch:()=>i()}),(r,s)=>(c.openBlock(),c.createElementBlock("div",{style:c.normalizeStyle({display:t.inline?"inline-block":"block"})},[c.createElementVNode("div",{ref_key:"glitched",ref:l},[c.createElementVNode("div",null,[c.renderSlot(r.$slots,"default")])],512)],4))}}),b={mounted:(t,a)=>{g.glitch(t,a.value)}},w={install:t=>{t.component("GlitchedElement",$),t.directive("glitch",b)}};o.GlitchedElement=$,o.PowerGlitchPlugin=w,o.default=w,o.vGlitch=b,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
